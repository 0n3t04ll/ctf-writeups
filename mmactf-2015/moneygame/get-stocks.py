from pwn import *
from collections import defaultdict

"""
Due to srand(time(0)), we can dump the stock prices:
1 ['100.00', '103.69', '106.54', '110.85', '104.31', '111.88', '114.69', '111.86', '117.93', '126.51', '131.27', '135.95', '128.01', '133.62', '127.76', '120.87', '116.38', '111.27', '108.00', '107.84', '109.87', '112.48', '107.73', '113.54', '122.88', '125.52', '116.60', '124.02', '125.74', '115.81', '122.50', '127.85', '118.75', '119.36', '123.72', '129.33', '126.82', '135.22', '145.13', '150.00', '150.00', '148.56', '146.55', '138.58', '139.30', '147.49', '150.00', '146.61', '150.00', '141.78', '137.38', '139.99', '136.53', '128.03']
2 ['100.00', '102.06', '109.99', '112.96', '121.60', '126.75', '124.63', '117.03', '109.94', '108.20', '100.25', '101.57', '95.73', '104.20', '111.71', '116.78', '110.22', '106.40', '98.65', '105.05', '101.78', '93.18', '86.65', '91.30', '100.09', '107.56', '100.54', '93.98', '89.72', '95.31', '88.49', '94.28', '85.31', '87.73', '89.48', '99.44', '90.47', '98.92', '94.65', '90.45', '98.51', '101.92', '101.80', '107.86', '108.28', '99.87', '94.53', '87.58', '80.53', '88.29', '86.57', '93.41', '83.80', '91.80']
3 ['100.00', '101.82', '109.79', '112.76', '121.73', '118.56', '127.94', '119.78', '117.32', '113.93', '108.94', '116.01', '116.57', '110.09', '117.83', '116.28', '122.61', '126.92', '129.71', '136.33', '145.00', '144.98', '144.69', '142.87', '134.12', '140.44', '145.77', '137.28', '146.62', '150.00', '150.00', '150.00', '150.00', '150.00', '147.47', '142.41', '140.33', '137.26', '139.93', '133.75', '130.75', '139.12', '144.09', '141.47', '146.17', '150.00', '150.00', '149.70', '150.00', '150.00', '150.00', '150.00', '149.29', '144.63']
"""

r = process('./moneygame')

stocks = defaultdict(list)

def send_action(action):
    r.readuntil('$')
    cash = r.readuntil('!')[:-1]
    r.readuntil('#1: $')
    stock1 = r.readuntil(' (').split()[0]
    r.readuntil('#2: $')
    stock2 = r.readuntil(' (').split()[0]
    r.readuntil('#3: $')
    stock3 = r.readuntil(' (').split()[0]

    log.info("Cash: {}".format(cash))
    log.info("Stock 1: {}".format(stock1))
    log.info("Stock 2: {}".format(stock2))
    log.info("Stock 3: {}".format(stock3))

    r.sendline(action)

for _ in xrange(2):
    try:
        while True:
            r.readuntil('$')
            cash = r.readuntil('!')[:-1]
            r.readuntil('#1: $')
            stock1 = r.readuntil(' (').split()[0]
            r.readuntil('#2: $')
            stock2 = r.readuntil(' (').split()[0]
            r.readuntil('#3: $')
            stock3 = r.readuntil(' (').split()[0]

            log.info("Cash: {}".format(cash))
            log.info("Stock 1: {}".format(stock1))
            log.info("Stock 2: {}".format(stock2))
            log.info("Stock 3: {}".format(stock3))

            r.sendline()
    except:
        for key, val in stocks.iteritems():
            print key, val

